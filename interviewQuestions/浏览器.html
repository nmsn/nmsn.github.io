<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器 | NMSN</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/favicon.ico">
    <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?6594ba1364804631f0a8fd4452766fed";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
    <script aysnc="true" src="https://www.googletagmanager.com/gtag/js?id=UA-127895888-1"></script>
    <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-127895888-1');
  </script>
    <meta name="description" content="Somebody has to win, so why not be me?">
    <link rel="preload" href="/assets/css/0.styles.8eb54cf4.css" as="style"><link rel="preload" href="/assets/js/app.139693ee.js" as="script"><link rel="preload" href="/assets/js/2.4a609977.js" as="script"><link rel="preload" href="/assets/js/15.3d38a3dd.js" as="script"><link rel="prefetch" href="/assets/js/10.1508431a.js"><link rel="prefetch" href="/assets/js/11.a8d4d8de.js"><link rel="prefetch" href="/assets/js/12.64b146dd.js"><link rel="prefetch" href="/assets/js/13.c768d2ed.js"><link rel="prefetch" href="/assets/js/14.6ba75e19.js"><link rel="prefetch" href="/assets/js/16.3b71c3d4.js"><link rel="prefetch" href="/assets/js/17.bfdcdb09.js"><link rel="prefetch" href="/assets/js/18.d51a683e.js"><link rel="prefetch" href="/assets/js/19.23df3402.js"><link rel="prefetch" href="/assets/js/20.18bff528.js"><link rel="prefetch" href="/assets/js/21.5f084c8f.js"><link rel="prefetch" href="/assets/js/22.83d56967.js"><link rel="prefetch" href="/assets/js/23.1ca87db8.js"><link rel="prefetch" href="/assets/js/24.a5ed989e.js"><link rel="prefetch" href="/assets/js/25.c205d178.js"><link rel="prefetch" href="/assets/js/26.bc66ddb7.js"><link rel="prefetch" href="/assets/js/27.a203ad60.js"><link rel="prefetch" href="/assets/js/28.a5fddc03.js"><link rel="prefetch" href="/assets/js/29.b8135a81.js"><link rel="prefetch" href="/assets/js/3.92f844fc.js"><link rel="prefetch" href="/assets/js/30.8e3f504e.js"><link rel="prefetch" href="/assets/js/31.1a40ce54.js"><link rel="prefetch" href="/assets/js/32.3182375a.js"><link rel="prefetch" href="/assets/js/33.9035e369.js"><link rel="prefetch" href="/assets/js/34.c88060a1.js"><link rel="prefetch" href="/assets/js/35.ebe94d64.js"><link rel="prefetch" href="/assets/js/36.f2c55ad2.js"><link rel="prefetch" href="/assets/js/37.dcba3dac.js"><link rel="prefetch" href="/assets/js/38.702fee13.js"><link rel="prefetch" href="/assets/js/39.bd6dcc51.js"><link rel="prefetch" href="/assets/js/4.a5e6f7c3.js"><link rel="prefetch" href="/assets/js/40.d3bb0c9e.js"><link rel="prefetch" href="/assets/js/41.cde4c57a.js"><link rel="prefetch" href="/assets/js/42.0de83a4e.js"><link rel="prefetch" href="/assets/js/43.e1b7b0a2.js"><link rel="prefetch" href="/assets/js/44.427f477d.js"><link rel="prefetch" href="/assets/js/45.58ee4553.js"><link rel="prefetch" href="/assets/js/46.7939ee37.js"><link rel="prefetch" href="/assets/js/47.5fdb4957.js"><link rel="prefetch" href="/assets/js/48.eafd4d23.js"><link rel="prefetch" href="/assets/js/49.c5fde335.js"><link rel="prefetch" href="/assets/js/5.d1ebbe8e.js"><link rel="prefetch" href="/assets/js/50.02dfe76e.js"><link rel="prefetch" href="/assets/js/51.cebce812.js"><link rel="prefetch" href="/assets/js/52.d2188264.js"><link rel="prefetch" href="/assets/js/53.187a5597.js"><link rel="prefetch" href="/assets/js/54.e3d736d5.js"><link rel="prefetch" href="/assets/js/55.e8266192.js"><link rel="prefetch" href="/assets/js/56.525a30bb.js"><link rel="prefetch" href="/assets/js/57.53d73e65.js"><link rel="prefetch" href="/assets/js/58.0779ff8b.js"><link rel="prefetch" href="/assets/js/6.442a394c.js"><link rel="prefetch" href="/assets/js/7.16e79d1e.js"><link rel="prefetch" href="/assets/js/8.6f768000.js"><link rel="prefetch" href="/assets/js/9.05ee9782.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8eb54cf4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NMSN</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/tech/" class="nav-link">
  快查总结
</a></div><div class="nav-item"><a href="/excerpt/" class="nav-link">
  摘录
</a></div><div class="nav-item"><a href="/interviewQuestions/" class="nav-link router-link-active">
  面试题
</a></div><div class="nav-item"><a href="/readingNotes/" class="nav-link">
  读书笔记
</a></div><div class="nav-item"><a href="/work/" class="nav-link">
  工作总结
</a></div> <a href="https://github.com/nmsn" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/tech/" class="nav-link">
  快查总结
</a></div><div class="nav-item"><a href="/excerpt/" class="nav-link">
  摘录
</a></div><div class="nav-item"><a href="/interviewQuestions/" class="nav-link router-link-active">
  面试题
</a></div><div class="nav-item"><a href="/readingNotes/" class="nav-link">
  读书笔记
</a></div><div class="nav-item"><a href="/work/" class="nav-link">
  工作总结
</a></div> <a href="https://github.com/nmsn" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>面试题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interviewQuestions/HTML.html" class="sidebar-link">HTML</a></li><li><a href="/interviewQuestions/CSS.html" class="sidebar-link">CSS</a></li><li><a href="/interviewQuestions/JS.html" class="sidebar-link">JS</a></li><li><a href="/interviewQuestions/Network.html" class="sidebar-link">网络</a></li><li><a href="/interviewQuestions/浏览器.html" class="active sidebar-link">浏览器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interviewQuestions/浏览器.html#浏览器内核" class="sidebar-link">浏览器内核</a></li><li class="sidebar-sub-header"><a href="/interviewQuestions/浏览器.html#load-事件与-domcontentloaded-事件的先后" class="sidebar-link">load 事件与 DOMContentLoaded 事件的先后</a></li><li class="sidebar-sub-header"><a href="/interviewQuestions/浏览器.html#css-加载会造成阻塞吗" class="sidebar-link">css 加载会造成阻塞吗</a></li><li class="sidebar-sub-header"><a href="/interviewQuestions/浏览器.html#普通图层和复合图层" class="sidebar-link">普通图层和复合图层</a></li><li class="sidebar-sub-header"><a href="/interviewQuestions/浏览器.html#事件循环-event-loop" class="sidebar-link">事件循环（Event Loop）</a></li></ul></li><li><a href="/interviewQuestions/React.html" class="sidebar-link">React</a></li><li><a href="/interviewQuestions/Vue.html" class="sidebar-link">Vue</a></li><li><a href="/interviewQuestions/TypeScript.html" class="sidebar-link">TypeScript</a></li><li><a href="/interviewQuestions/Webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/interviewQuestions/设计模式.html" class="sidebar-link">设计模式</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器"><a href="#浏览器" class="header-anchor">#</a> 浏览器</h1> <h2 id="浏览器内核"><a href="#浏览器内核" class="header-anchor">#</a> 浏览器内核</h2> <h3 id="浏览器内核种类"><a href="#浏览器内核种类" class="header-anchor">#</a> 浏览器内核种类</h3> <table><thead><tr><th>浏览器</th> <th>内核（渲染引擎）</th> <th>JavaScript 引擎</th></tr></thead> <tbody><tr><td>Chrome</td> <td>Blink（28~）Webkit（Chrome 27）</td> <td>V8</td></tr> <tr><td>FireFox</td> <td>Gecko</td> <td>SpiderMonkey</td></tr> <tr><td>Safari</td> <td>Webkit</td> <td>JavaScriptCore</td></tr> <tr><td>IE</td> <td>Trident</td> <td>Chakra</td></tr></tbody></table> <h3 id="浏览器进程"><a href="#浏览器进程" class="header-anchor">#</a> 浏览器进程</h3> <p>以 Chrome 浏览器为例，多进程架构包括：</p> <ul><li><strong>浏览器进程</strong>：选项卡之外的所有内容都由浏览器进程处理，浏览器进程则主要用于控制和处理用户可见的 UI 部分（包括地址栏，书签，后退和前进按钮）和用户不可见的隐藏部分（例如网络请求和文件访问）。</li> <li><strong>GPU 进程</strong>：该进程用于完成图像处理任务，同时还支持分解成多个进程进行处理。</li> <li><strong>渲染器进程</strong>：Chrome 浏览器中支持多个选项卡，其中每个选项卡在单独的渲染器进程中运行，渲染器进程主要用于控制和处理选项卡中的网站内容显示。</li> <li><strong>插件进程</strong>：管理 Chrome 浏览器中的各个插件。</li></ul> <p>Chrome 渲染器进程中的线程</p> <ul><li>GUI 渲染线程：负责对浏览器界面进行渲染</li> <li>JS 引擎线程：负责解析和执行 JS 脚本</li> <li>浏览器定时器触发线程：setTimeout 和 setInterval 所在的线程</li> <li>浏览器事件触发线程：该线程负责处理浏览器事件，并将事件触发后需要执行的代码放置到 JS 引擎中执行</li></ul> <p>Chrome 浏览器进程中的线程</p> <ul><li>UI 线程：用于绘制浏览器的按钮和输入字段</li> <li>网络线程：用于处理网络请求，以及从服务器接收数据</li> <li>存储线程：用于控制对文件的访问</li></ul> <h3 id="浏览器线程"><a href="#浏览器线程" class="header-anchor">#</a> 浏览器线程</h3> <p><img src="data:image/png;base64,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" alt="浏览器线程"></p> <h3 id="gui-渲染线程"><a href="#gui-渲染线程" class="header-anchor">#</a> GUI 渲染线程</h3> <ul><li>负责渲染浏览器界面，解析 HTML、CSS，构建 DOM 树、CSSOM 树和 RenderObject 树，布局和绘制等</li> <li>当界面需要重绘（Repaint）或由于某种操作引发（reflow）时，该线程就会执行</li> <li>注意，<strong>GUI 渲染线程与 JS 引擎线程是互斥的</strong>，当 JS 引擎执行时 GUI 线程会被挂起（相当于被冻结了），GUI 更会会保存在一个队列中<strong>等到 JS 引擎空闲时</strong>立即被执行</li></ul> <h3 id="js-引擎线程"><a href="#js-引擎线程" class="header-anchor">#</a> JS 引擎线程</h3> <ul><li>也称为 JS 内核，负责处理 Javascript 脚本程序（例如 V8 引擎）</li> <li>JS 引擎线程负责解析 Javascript 脚本，运行代码</li> <li>JS 引擎一直等待着任务队列中任务的到来，然后加以处理，一个 Tab 页中无论什么时候都只有一个 JS 线程在运行程序</li> <li>同样注意，<strong>GUI 渲染线程和 JS 引擎线程是互斥的</strong>，所以如果 JS 执行的时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞</li></ul> <h3 id="事件触发线程"><a href="#事件触发线程" class="header-anchor">#</a> 事件触发线程</h3> <ul><li>归属于浏览器而不是 JS 引擎，用来控制事件循环，<strong>管理任务队列</strong></li> <li>当 JS 引擎执行代码块如 setTimeout，鼠标点击，AJAX 异步请求时，会将对应任务添加到事件线程中</li> <li>当对应的事件符合触发条件被触发时，该线程会把事件添加到待处理队列的队尾，等待 JS 引擎的处理</li> <li>注意，由于 JS 的单线程关系，所以这些待处理队列中的事件都得排队等待 JS 引擎处理（当 JS 引擎空闲时才会去执行）</li></ul> <h3 id="定时器触发线程"><a href="#定时器触发线程" class="header-anchor">#</a> 定时器触发线程</h3> <ul><li>传说中的 setInterval 与 setTimeout 所在的线程</li> <li>浏览器定时计数器并不是有 JavaScript 引擎计数的（因为 JavaScript 引擎是单线程的，如果处于阻塞线程状态就会影响计时的准确）</li> <li>因此通过单独线程来计时并触发定时（计时完毕后，添加到任务队列中，等待 JS 引擎空闲后执行）</li> <li>注意，W3C 在 HTML 标准中规定，规定要求 setTimeout 中低于 4ms 的时间间隔算为 4ms</li></ul> <h3 id="异步-http-请求线程"><a href="#异步-http-请求线程" class="header-anchor">#</a> 异步 http 请求线程</h3> <ul><li>在 XMLHttpRequest 在连接后是通过浏览器新开一个线程请求</li> <li>将检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件，将这个回调再放入待处理队列中，再由 JavaScript 引擎执行</li></ul> <h2 id="load-事件与-domcontentloaded-事件的先后"><a href="#load-事件与-domcontentloaded-事件的先后" class="header-anchor">#</a> load 事件与 DOMContentLoaded 事件的先后</h2> <ul><li>当 DOMContentLoaded 事件触发时，仅当 DOM 加载完成，不包括样式表，图片。
(譬如如果有 async 加载的脚本就不一定完成)</li> <li>当 onload 事件触发时，页面上所有的 DOM，样式表，脚本，图片都已经加载完成了。（渲染完毕了）</li></ul> <p>顺序是：DOMContentLoaded -&gt; load</p> <p>DOMContentLoaded 的其他情况：</p> <ol><li>如果页面中同时存在 css 和 js，并且存在 js 在 css 后面，则 DOMContentLoaded 事件会在 css 加载完后才执行，因为 js 下载解析执行使用 js 引擎线程阻塞 GUI 渲染线程。</li> <li>其他情况下，DOMContentLoaded 都不会等待 css 加载，并且 DOMContentLoaded 事件也不会等待图片、视频等其他资源加载。</li></ol> <p>当文档中没有脚本时，浏览器解析完文档便能触发 DOMContentLoaded 事件。如果文档中包含脚本，则脚本会阻塞文档的解析，而脚本需要等 CSSOM 构建完才能执行(JS 因为可能会去获取 DOM 的样式，所以 JS 会等待样式表加载完毕，而 JS 是阻塞 DOM 的解析的，所以在有外部样式表的时候，JS 会一直阻塞到外部样式表下载完毕)。在任何情况下 DOMContentLoaded 的触发不需要等待图片或其他资源加载完成。</p> <h2 id="css-加载会造成阻塞吗"><a href="#css-加载会造成阻塞吗" class="header-anchor">#</a> css 加载会造成阻塞吗</h2> <p>原文：<a href="https://segmentfault.com/a/1190000018130499" target="_blank" rel="noopener noreferrer">css 加载会造成阻塞吗<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>结论：</p> <ol><li>css 加载不会阻塞 DOM 树的解析</li> <li>css 加载会阻塞 DOM 树的渲染</li> <li>css 加载会阻塞后面 js 语句的执行</li></ol> <p>浏览器渲染流程如下：</p> <p><img src="/assets/img/brower_paint.a7c25013.png" alt="浏览器渲染"></p> <ol><li>浏览器获取 HTML 文件，然后对文件进行解析，形成 DOM Tree</li> <li>与此同时，进行 CSS 解析，生成 Style Rules</li> <li>接着将 DOM Tree 与 Style Rules 合成为 Render Tree</li> <li>接着进入布局（Layout）阶段，也就是为每个节点分配一个应出现在屏幕上的确切坐标</li> <li>随后调用 GPU 进行绘制（Paint），遍历 Render Tree 的节点，并将元素呈现出来</li></ol> <p>解释：</p> <ol><li>DOM 解析和 CSS 解析是两个并行的进程，所以这也就是为什么 CSS 加载不会阻塞 DOM 的解析</li> <li>然而由于 Render 树是依赖 DOM 树和 CSSOM 树的，所以它必须等待到 CSSOM 树构建完成，也就是 CSS 资源加载完成（或加载失败）后，才能开始渲染。因此 CSS 加载是会阻塞 DOM 的渲染的</li> <li>由于 js 可能会操作之前的 DOM 节点和 CSS 样式，因此浏览器会维持 html 中 css 和 js 的顺序。因此样式表会在后面的 js 执行前先加载执行完成。所以 css 会阻塞后面的 js 执行</li></ol> <h2 id="普通图层和复合图层"><a href="#普通图层和复合图层" class="header-anchor">#</a> 普通图层和复合图层</h2> <p>渲染步骤中就提到了 composite 概念。</p> <p>可以简单的这样理解，浏览器渲染的图层一般包含两大类：普通图层以及复合图层。</p> <p>首先，普通文档流内可以理解为一个复合图层（这里称为默认复合层，里面不管添加多少元素，其实都是在同一个复合图层中）</p> <p>其次，absolute 布局（fixed 也一样），虽然可以脱离普通文档流，但它仍然属于默认复合层。</p> <p>然后，可以通过硬件加速的方式，声明一个新的复合图层，它会单独分配资源
（当然也会脱离普通文档流，这样一来，不管这个复合图层中怎么变化，也不会影响默认复合层里的回流重绘）</p> <p>可以简单理解下：GPU 中，各个复合图层是单独绘制的，所以互不影响，这也是为什么某些场景硬件加速效果一级棒</p> <h3 id="如何变成符合图层"><a href="#如何变成符合图层" class="header-anchor">#</a> 如何变成符合图层</h3> <p>将该元素变成一个复合图层，就是传说中的硬件加速技术</p> <ul><li>最常用的方式：translate3d、translateZ</li> <li>opacity 属性/过渡动画（需要动画执行的过程中才会创建合成层，动画没有开始或结束后元素还会回到之前的状态）</li> <li>will-chang 属性（这个比较偏僻），一般配合 opacity 与 translate 使用（而且经测试，除了上述可以引发硬件加速的属性外，其它属性并不会变成复合层），作用是提前告诉浏览器要变化，这样浏览器会开始做一些优化工作（这个最好用完后就释放）</li> <li><code>&lt;video&gt;&lt;iframe&gt;&lt;canvas&gt;&lt;webgl&gt;</code>等元素</li> <li>其它，譬如以前的 flash 插件</li></ul> <h3 id="absolute-和硬件加速的区别"><a href="#absolute-和硬件加速的区别" class="header-anchor">#</a> absolute 和硬件加速的区别</h3> <p>可以看到，absolute 虽然可以脱离普通文档流，但是无法脱离默认复合层。</p> <p>所以，就算 absolute 中信息改变时不会改变普通文档流中 render 树，但是，浏览器最终绘制时，是整个复合层绘制的，所以 absolute 中信息的改变，仍然会影响整个复合层的绘制。</p> <p>浏览器会重绘它，如果复合层中内容多，absolute 带来的绘制信息变化过大，资源消耗是非常严重的</p> <p>而硬件加速直接就是在另一个复合层了（另起炉灶），所以它的信息改变不会影响默认复合层（当然了，内部肯定会影响属于自己的复合层），仅仅是引发最后的合成（输出视图）</p> <h3 id="复合图层的作用"><a href="#复合图层的作用" class="header-anchor">#</a> 复合图层的作用</h3> <p>一般一个元素开启硬件加速后会变成复合图层，可以独立于普通文档流中，改动后可以避免整个页面重绘，提升性能</p> <p>但是尽量不要大量使用复合图层，否则由于资源消耗过度，页面反而会变的更卡</p> <h2 id="事件循环-event-loop"><a href="#事件循环-event-loop" class="header-anchor">#</a> 事件循环（Event Loop）</h2> <p>众所周知 JS 是门非阻塞单线程语言，因为在最初 JS 就是为了和浏览器交互而诞生的。如果 JS 是门多线程的语言话，我们在多个线程中处理 DOM 就可能会发生问题（一个线程中新加节点，另一个线程中删除节点），当然可以引入读写锁解决这个问题。</p> <p>JS 在执行的过程中会产生执行环境，这些执行环境会被顺序的加入到执行栈中。如果遇到异步的代码，会被挂起并加入到 Task（有多种 task） 队列中。一旦执行栈为空，Event Loop 就会从 Task 队列中拿出需要执行的代码并放入执行栈中执行，所以本质上来说 JS 中的异步还是同步行为。</p> <p>以上代码虽然 setTimeout 延时为 0，其实还是异步。这是因为 HTML5 标准规定这个函数第二个参数不得小于 4 毫秒，不足会自动增加。所以 setTimeout 还是会在 script end 之后打印。</p> <p>不同的任务源会被分配到不同的 Task 队列中，任务源可以分为 微任务（microtask） 和 宏任务（macrotask）。在 ES6 规范中，microtask 称为 jobs，macrotask 称为 task。</p> <p>宏任务包括</p> <ul><li>script</li> <li>setTimeout</li> <li>setInterval</li> <li>setImmediate</li> <li>I/O</li> <li>UI rendering</li></ul> <p>微任务包括</p> <ul><li>process.nextTick</li> <li>promise</li> <li>Object.observe</li> <li>MutationObserver</li></ul> <ol><li>执行同步代码，这属于宏任务</li> <li><strong>执行栈为空，查询是否有微任务需要执行</strong></li> <li>执行所有微任务</li> <li>必要的话渲染 UI</li> <li>然后开始下一轮 Event loop，执行宏任务中的异步代码</li></ol> <p>node 环境下，process.nextTick 的优先级高于 Promise，也就是可以简单理解为，在宏任务结束后会先执行微任务队列中的 nextTickQueue 部分，然后才会执行微任务中的 Promise 部分。
setImmediate 则是规定：在下一次<code>Event loop</code>时触发（所以它是属于优先级较高的宏任务，排在 setTimeout 前面）</p> <p>注：polyfill 中的 setTimeout 是 macrotask</p> <p>补充：</p> <p>除了宏任务、微任务队列外，还包含 requestAnimationFrame 所在的 animation 队列以及 requestIdleCallback 所在的 idle 队列。</p> <p>requestAnimationFrame处于渲染阶段，不在微任务队列，也不在宏任务队列</p> <p>执行顺序</p> <ul><li>同步代码</li> <li>微任务队列会在 JS 运行栈为空的时候立即执行</li> <li>animation 队列会在页面渲染前执行</li> <li>宏任务队列优先级低于微任务队列，一般也会比 animation 队列优先级低，但不是绝对</li> <li>idle 队列优先级最低，当浏览器有空闲时间的时候才会执行</li></ul> <p>队列特点</p> <ul><li><p>宏任务队列，每次只会执行队列内的一个任务。</p></li> <li><p>微任务队列，每次会执行队列里的全部任务。假设微任务队列内有 100 个 Promise，它们会一次过全部执行完。这种情况下极有可能会导致页面卡顿。如果在微任务执行过程中继续往微任务队列中添加任务，新添加的任务也会在当前事件循环中执行，很容易造成死循环, 如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>animation 队列，跟微任务队列有点相似，每次会执行队列里的全部任务。但如果在执行过程中往队列中添加新的任务，新的任务不会在当前事件循环中执行，而是在下次事件循环中执行。</p></li> <li><p>idle 队列，每次只会执行一个任务。任务完成后会检查是否还有空闲时间，有的话会继续执行下一个任务，没有则等到下次有空闲时间再执行。需要注意的是此队列中的任务也有可能阻塞页面，当空闲时间用完后任务不会主动退出。如果任务占用时间较长，一般会将任务拆分成多个阶段，执行完一个阶段后检查还有没有空闲时间，有则继续，无则注册一个新的 idle 队列任务，然后退出当前任务。React Fiber 就是用这个机制。但最新版的 React Fiber 已经不用 rIC 了，因为调用的频率太低，改用 rAF 了</p></li></ul> <h3 id="参考文献"><a href="#参考文献" class="header-anchor">#</a> 参考文献</h3> <ul><li>Event loop：<a href="https://yuchengkai.cn/docs/frontend/browser.html#event-loop" target="_blank" rel="noopener noreferrer">https://yuchengkai.cn/docs/frontend/browser.html#event-loop<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2021/8/28 上午10:20:00</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/interviewQuestions/Network.html" class="prev">
        网络
      </a></span> <span class="next"><a href="/interviewQuestions/React.html">
        React
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.139693ee.js" defer></script><script src="/assets/js/2.4a609977.js" defer></script><script src="/assets/js/15.3d38a3dd.js" defer></script>
  </body>
</html>
